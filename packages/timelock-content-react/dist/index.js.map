{"version":3,"sources":["../src/hooks/useTimeLockContent.ts","../src/hooks/useListing.ts","../src/hooks/useListingParsed.ts","../src/hooks/useCreateListing.ts","../src/hooks/useBuyListing.ts","../src/hooks/useRevealKey.ts","../src/hooks/useClaimRefund.ts","../src/hooks/useAllListingsParsed.ts","../src/hooks/useRefunded.ts","../src/hooks/usePurchased.ts","../src/hooks/useCreateWhistleBlowerListing.ts"],"sourcesContent":["import { useMemo } from \"react\";\r\nimport type { Address } from \"viem\";\r\nimport { useChainId, usePublicClient, useWalletClient } from \"wagmi\";\r\nimport { createTimeLockContentClient, getTimelockAddress } from \"@webdrei/timelock-content-sdk\";\r\n\r\nexport function useTimeLockContent(opts?: { address?: Address }) {\r\n    const chainId = useChainId();\r\n    const publicClient = usePublicClient();\r\n    if (!publicClient) throw new Error(\"No publicClient (wagmi config missing?)\");\r\n    const { data: walletClient } = useWalletClient();\r\n\r\n    const address = opts?.address ?? getTimelockAddress(chainId);\r\n\r\n    const client = useMemo(() => {\r\n        return createTimeLockContentClient({\r\n            address,\r\n            publicClient,\r\n            walletClient: walletClient ?? undefined,\r\n        });\r\n    }, [address, publicClient, walletClient]);\r\n\r\n    return { client, address, chainId, publicClient, walletClient };\r\n}\r\n","import { useQuery } from \"@tanstack/react-query\";\r\nimport type { Address } from \"viem\";\r\nimport { useTimeLockContent } from \"./useTimeLockContent\";\r\n\r\nexport function useListing(listingId: bigint | undefined, opts?: { address?: Address; enabled?: boolean }) {\r\n    const { client } = useTimeLockContent({ address: opts?.address });\r\n\r\n    return useQuery({\r\n        queryKey: [\"timelock\", \"listing\", opts?.address ?? \"auto\", listingId?.toString()],\r\n        enabled: Boolean(listingId) && (opts?.enabled ?? true),\r\n        queryFn: async () => client.getListing(listingId!),\r\n    });\r\n}\r\n","import { useQuery } from \"@tanstack/react-query\";\r\nimport type { Address } from \"viem\";\r\nimport { useTimeLockContent } from \"./useTimeLockContent\";\r\n\r\nexport function useListingParsed(listingId: bigint | undefined, opts?: { address?: Address; enabled?: boolean }) {\r\n    const { client } = useTimeLockContent({ address: opts?.address });\r\n\r\n    return useQuery({\r\n        queryKey: [\"timelock\", \"listingParsed\", opts?.address ?? \"auto\", listingId?.toString()],\r\n        enabled: Boolean(listingId) && (opts?.enabled ?? true),\r\n        queryFn: async () => client.getListingParsed(listingId!),\r\n    });\r\n}\r\n","import { useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport type { Address } from \"viem\";\r\nimport type { CreateListingArgs } from \"@webdrei/timelock-content-sdk\";\r\nimport { useTimeLockContent } from \"./useTimeLockContent\";\r\n\r\nexport function useCreateListing(opts?: { address?: Address }) {\r\n    const qc = useQueryClient();\r\n    const { client, address } = useTimeLockContent({ address: opts?.address });\r\n\r\n    return useMutation({\r\n        mutationFn: async (args: CreateListingArgs) => client.createListingAndWait(args),\r\n        onSuccess: async () => {\r\n            // optional: refresh list counts etc.\r\n            await qc.invalidateQueries({ queryKey: [\"timelock\"] });\r\n        },\r\n    });\r\n}\r\n","import { useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport type { Address } from \"viem\";\r\nimport type { BuyArgs } from \"@webdrei/timelock-content-sdk\";\r\nimport { useTimeLockContent } from \"./useTimeLockContent\";\r\n\r\nexport function useBuyListing(opts?: { address?: Address }) {\r\n    const qc = useQueryClient();\r\n    const { client } = useTimeLockContent({ address: opts?.address });\r\n\r\n    return useMutation({\r\n        mutationFn: async (args: BuyArgs) => client.buyAndWait(args),\r\n        onSuccess: async () => {\r\n            await qc.invalidateQueries({ queryKey: [\"timelock\"] });\r\n        },\r\n    });\r\n}\r\n","import { useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport type { Address } from \"viem\";\r\nimport type { RevealKeyArgs } from \"@webdrei/timelock-content-sdk\";\r\nimport { useTimeLockContent } from \"./useTimeLockContent\";\r\n\r\nexport function useRevealKey(opts?: { address?: Address }) {\r\n    const qc = useQueryClient();\r\n    const { client } = useTimeLockContent({ address: opts?.address });\r\n\r\n    return useMutation({\r\n        mutationFn: async (args: RevealKeyArgs) => client.revealKeyAndWait(args),\r\n        onSuccess: async () => {\r\n            await qc.invalidateQueries({ queryKey: [\"timelock\"] });\r\n        },\r\n    });\r\n}\r\n","import { useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport type { Address } from \"viem\";\r\nimport { useTimeLockContent } from \"./useTimeLockContent\";\r\n\r\nexport function useClaimRefund(opts?: { address?: Address }) {\r\n    const qc = useQueryClient();\r\n    const { client } = useTimeLockContent({ address: opts?.address });\r\n\r\n    return useMutation({\r\n        mutationFn: async (listingId: bigint) => client.claimRefundAndWait(listingId),\r\n        onSuccess: async () => {\r\n            await qc.invalidateQueries({ queryKey: [\"timelock\"] });\r\n        },\r\n    });\r\n}\r\n","import { useQuery } from \"@tanstack/react-query\";\r\nimport type { Address } from \"viem\";\r\nimport { useTimeLockContent } from \"./useTimeLockContent\";\r\nexport function useAllListingsParsed(opts?: { address?: Address; enabled?: boolean }) {\r\n    const { client } = useTimeLockContent({ address: opts?.address });\r\n\r\n    return useQuery({\r\n        queryKey: [\"timelock\", \"allListingsParsed\", opts?.address ?? \"auto\"],\r\n        enabled: opts?.enabled ?? true,\r\n        queryFn: async () => {\r\n            console.log(\"ðŸ” Fetching all listings...\");\r\n\r\n            const count = await client.listingCount();\r\n            console.log(\"ðŸ“Š Total count:\", count);\r\n\r\n            const n = Number(count);\r\n\r\n            try {\r\n                const items = await Promise.all(\r\n                    Array.from({ length: n }, (_, i) => {\r\n                        console.log(`ðŸ“¥ Fetching listing ${i + 1}/${n}`);\r\n                        return client.getListingParsed(BigInt(i + 1));\r\n                    })\r\n                );\r\n\r\n                console.log(\"âœ… All listings fetched:\", items);\r\n                return items.map((x, idx) => ({ ...x, listingId: BigInt(idx + 1) }));\r\n\r\n            } catch (e) {\r\n                console.error(\"âŒ Error fetching listings:\", e);\r\n                throw e;\r\n            }\r\n        },\r\n    });\r\n}","import { useQuery } from \"@tanstack/react-query\";\r\nimport { useAccount } from \"wagmi\";\r\nimport { useTimeLockContent } from \"./useTimeLockContent\";\r\n\r\nexport function useRefunded(listingId?: bigint) {\r\n    const { address: user } = useAccount();\r\n    const { client, chainId } = useTimeLockContent();\r\n\r\n    return useQuery({\r\n        queryKey: [\"timelock\", \"refunded\", chainId, listingId?.toString(), user],\r\n        enabled: !!listingId && !!user,\r\n        queryFn: async () => {\r\n            if (!listingId || !user) return false;\r\n            return client.refunded(listingId, user);\r\n        },\r\n        staleTime: 15_000,\r\n    });\r\n}\r\n","import { useQuery } from \"@tanstack/react-query\";\r\nimport { useAccount } from \"wagmi\";\r\nimport { useTimeLockContent } from \"./useTimeLockContent\";\r\n\r\nexport function usePurchased(listingId?: bigint) {\r\n    const { address: user } = useAccount();\r\n    const { client, chainId } = useTimeLockContent();\r\n\r\n    return useQuery({\r\n        queryKey: [\"timelock\", \"purchased\", chainId, listingId?.toString(), user],\r\n        enabled: !!listingId && !!user,\r\n        queryFn: async () => {\r\n            if (!listingId || !user) return false;\r\n            return client.purchased(listingId, user);\r\n        },\r\n        staleTime: 15_000,\r\n    });\r\n}\r\n","// useCreateWhistleblowerListing.ts\r\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport type { Address } from \"viem\";\r\nimport { TimelockHelper } from \"@webdrei/timelock-content-sdk\";\r\nimport { useTimeLockContent } from \"./useTimeLockContent\";\r\n\r\nexport interface CreateWhistleblowerListingArgs {\r\n    releaseTime: bigint;\r\n    cipherUri: string;\r\n    cipherHash: `0x${string}`;\r\n    encryptionKey: Uint8Array; // Will be timelock-encrypted automatically\r\n    price?: bigint; // default: 0n\r\n}\r\n\r\nexport function useCreateWhistleblowerListing(opts?: { address?: Address }) {\r\n    const qc = useQueryClient();\r\n    const { client } = useTimeLockContent({ address: opts?.address });\r\n\r\n    return useMutation({\r\n        mutationFn: async (args: CreateWhistleblowerListingArgs) => {\r\n            // Auto-calculate drand round\r\n            const drandRound = TimelockHelper.getDrandRound(args.releaseTime);\r\n\r\n            // Auto-encrypt key\r\n            const timelockEncryptedKey = await TimelockHelper.encryptWithRound(\r\n                args.encryptionKey,\r\n                drandRound\r\n            );\r\n\r\n            return client.createListingAndWait({\r\n                price: args.price ?? 0n,\r\n                releaseTime: args.releaseTime,\r\n                cipherUri: args.cipherUri,\r\n                cipherHash: args.cipherHash,\r\n                keyCommitment: \"0x0000000000000000000000000000000000000000000000000000000000000000\",\r\n                revealGraceSeconds: 0n,\r\n                deposit: 0n,\r\n\r\n                // Timelock enabled\r\n                isTimelockEnabled: true,\r\n                drandRound,\r\n                timelockEncryptedKey\r\n            });\r\n        },\r\n        onSuccess: async () => {\r\n            await qc.invalidateQueries({ queryKey: [\"timelock\"] });\r\n        },\r\n    });\r\n}"],"mappings":"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","names":["useQuery","useQuery","useMutation","useQueryClient","useQueryClient","useMutation","useMutation","useQueryClient","useQueryClient","useMutation","useMutation","useQueryClient","useQueryClient","useMutation","useQuery","useQuery","useQuery","useQuery","useQuery","useAccount","useAccount","useQuery","useMutation","useQueryClient","useQueryClient","useMutation"]}